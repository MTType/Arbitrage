<!DOCTYPE html>
<html>
    <head>
        <title>Arbitrage!</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="@{'/public/stylesheets/styles.css'}">
	<link href='http://fonts.googleapis.com/css?family=Quicksand:400,700' rel='stylesheet' type='text/css'>
    </head>

<body id="game">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>

<h1>Arbitrage!</h1>

<div id="portfolio">
    <div id="info"><div id="user"><img src="@{'/public/images/user.png'}" alt="user icon"><h3>Trader : MooseBoost</h3></div><div id="money" ><img src="@{'/public/images/money.png'}" alt="money"><h3>Money : Â£4,000</h3></div><div id="time"><img src="@{'/public/images/time.png'}" alt="clock"><h3>Time Left : 3 Days</h3></div></div>
    <div id="assets"><div id="pork"><img src="@{'/public/images/pork.png'}" alt="pork bellies"><h3>Pork Bellies : 300</h3></div><div id="frozen"><img src="@{'/public/images/frozen.png'}" alt="frozen orange juice"><h3>Frozen Orange Juice : 200</h3></div><div id="soy"><img src="@{'/public/images/soy.png'}" alt="soy beans"><h3>Soy Beans : 400</h3></div></div>
</div>
   
<div id="exchanges">
    <div id="nyse">
    <h3>NYSE</h3>
    <table>
    </table>
    </div>

    <div id="lse">
    <h3>LSE</h3>
    <table>
    </table>
    </div>

    <div id="nasdaq">
    <h3>NASDAQ</h3>
    <table>
    </table>
    </div>

</div>

<script>
    function getRequests(exchangeCode) {
        $.ajax({
            url: 'http://localhost:9000/getInitialRequests?exchangeCode=' + exchangeCode,
            type: 'GET',
            dataType: 'json',
            success: function(dataWeGotViaJson){
                var exchangeNode = document.getElementById(exchangeCode);
                while (exchangeNode.firstChild) {
                    exchangeNode.removeChild(exchangeNode.firstChild);
                }
                for (var i in dataWeGotViaJson) {
                    var button = document.createElement("BUTTON");
                    var t=document.createTextNode(dataWeGotViaJson[i].assetTypeString + "  " + dataWeGotViaJson[i].requestTypeString + "  " + dataWeGotViaJson[i].quantity + "  " + dataWeGotViaJson[i].pricePerUnit);
                    button.appendChild(t);
                    button.onclick = function() { 
                        alert("BLAH");
                    };

                    exchangeNode.appendChild(button);
                }  
            }
        });
    }
    //setInterval(function(){ refreshLSE(); }, 1000);
    
    window.onload = function() {
        getRequests("lse");
        getRequests("nyse");
        getRequests("nasdaq");
        refreshNYSE();
    }
    
    function refreshNYSE() {
        ws = new WebSocket("ws://localhost:9000/requestSocket");

        ws.onopen = function(evt) { 
        }

        ws.onclose = function(evt) {
        }

        ws.onmessage = function(evt) {
            alert(evt.data);
        }

        ws.onerror = function(evt) {
        }
    }
</script>

<div id="links">
    <div class="link"><h3>Instructions</h3></div>
    <div class="link"><h3>High Score</h3></div>
    <div class="link"><h3>Pause</h3></div>
    <a href="index"><div class="link" id="exit"><h3>Exit</h3></div></a>
</div>

</body>
</html>